<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Going big with MobX</title>

    <link rel="stylesheet" href="css/reveal.css">
    <!-- <link rel="stylesheet" href="css/theme/black.css"> -->
    <link rel="stylesheet" href="css/theme/solarized.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <style>
        .reveal pre {
            box-shadow: none;
        }

        .reveal section img {
            border: none;
            box-shadow: none;
            padding: 5px;
            background: white;
        }

        .reveal .text-on-bg {
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
        }

        img.nobg {
            background: transparent !important;
        }

        section .folder-container {
            margin: 10px;
            padding: 0 20px;
            margin: 0;
        }

        section .folder-wrapper {
            margin: 0;
            padding: 0;

            list-style-type: none;
        }

        section .file-item,
        section .folder-item {
            margin-left: -16px;
            padding-left: 20px;

            list-style-type: none;
        }

        .about {
            position: relative;
            bottom: -40px;
            display: flex;
            align-items: center;
        }

        .about .photo {
            border-radius: 50%;
            width: 100px;
            height: 100px;
        }

        .about .info {
            margin-left: 15px;
            font-size: 50%;
            text-align: left;
        }

        .about .logo {
            display: inline-block;
            width: 238px;
            height: 28px;
            background: transparent;
            margin: 0;
            padding: 0;
            position: relative;
            top: 9px;
        }

        .green {
            color: green;
        }

        .red {
            color: red;
        }

        .blue {
            color: blue;
        }

        .table td:first-child {
            color: #657b83;
        }

        .table td {
            border-bottom-color: #657b83 !important;
        }
    </style>

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h1>Going big with MobX</h1>
                <img style="width:200px;border: none;box-shadow: none;" src='assets/mobx.png' />
                <div class="about">
                    <img class="photo" src="assets/Sergey_Kostyrko.jpg" />
                    <div class="info">
                        Sergey Kostyrko,
                        <br /> Software Engineer @
                        <img class="logo" src="assets/logo.png" />
                    </div>
                </div>
            </section>
            <section>
                <section>
                    <h2>State management</h2>
                </section>
                <section>
                    Redux - standard de facto
                </section>
                <section>
                    <img src="assets/no-redux.png" />
                </section>
                <section>
                    <img src="assets/mobx-vs-redux.png" />
                    <br/>
                    <a href="https://www.youtube.com/watch?v=76FRrbY18Bs">
                        Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms
                    </a>
                </section>
            </section>
            <section>
                <section>
                    <h1>Why MobX?</h1>
                </section>
                <section>
                    <h2>Project</h2>
                    <ul>
                        <li class="fragment fade-in">App for financial analytics</li>
                        <li class="fragment fade-in">Team of 6 developers</li>
                        <li class="fragment fade-in">1 year of active development</li>
                        <li class="fragment fade-in">&gt; 20k LOC</li>
                    </ul>
                </section>
                <section data-background-image="assets/app.png" data-background-size="contain"></section>
                <section data-background-image="assets/multiscreen.jpg" data-background-size="contain"></section>
                <section>
                    <ul>
                        <li>Huge amount of data</li>
                        <li class="fragment fade-in">Real-time updates (4 times/sec)</li>
                        <li class="fragment fade-in">Intended to run whole working day</li>
                        <li class="fragment fade-in">Low memory and CPU consumption</li>
                    </ul>
                </section>
            </section>
            <section>
                <section>
                    <h1>MobX quick tour</h1>
                </section>
                <section>
                    <h3>Mutable</h3>
                    <h3 class="fragment highlight-blue">observable</h3>
                    <h3>state</h3>
                </section>
                <section>
                    Observable
                    <pre>
                        <code class='ts' data-trim>
class User {
    @observable firstName = 'Michel'
    @observable lastName = 'Weststrate'
}
                        </code>
                    </pre>
                </section>
                <!-- <section>
                    Observable (ES5)
                    <pre>
                        <code class='ts' data-trim>
class User {
    constructor () {
        extendObservable(this, {
            firstName: 'Michel',
            lastName: 'Weststrate'
        })
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    Observable (MobX v4+)
                    <pre>
                        <code class='ts' data-trim>
class User {
    firstName = 'Michel'
    lastName = 'Weststrate'
}
decorate(User, {
    firstName: observable,
    lastName: observable
})
                        </code>
                    </pre>
                </section> -->
                <section>
                    <h1>Derivations</h1>
                    <ul>
                        <li class="fragment fade-in">User interace</li>
                        <li class="fragment fade-in">Derived data (e.g. number of todos left)</li>
                        <li class="fragment fade-in">Backend integrations (like sending changes to the server)</li>
                    </ul>
                </section>
                <section>
                    <h3>MobX philosophy</h3>
                    <p>
                        Anything that can be derived from the application state, should be derived.
                    </p>
                    <br/>
                    <strong class="fragment fade-in">Automatically.</strong>
                </section>
                <section>
                    <h2>Computed values</h2>
                    <pre>
                        <code class='ts' data-trim>
class User {
    @observable firstName
    @observable fullName
    @computed get fullName () {
        return this.firstName + ' ' + this.lastName
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h2>Reactions</h2>
                    <pre>
                        <code class='ts'>
    autorun(() => console.log(user.fullName))

</code>
                    </pre>
                    <pre class="fragment fade-in">
                        <code class='ts fragment fade-in'>
    reaction(() => user.token, () => user.getDataFromServer())

</code>
                    </pre>
                </section>
                <section>
                    mobx-react
                    <pre>
                        <code class='jsx' data-trim>
@inject('user')
@observer
class UserInfo extends React.Component {
    render () {
        return <div>{this.props.user.fullName}</div>
    }
}
                        </code>
                        </pre>
                </section>
                <section>
                    <h1>Derivations</h1>
                    <ul>
                        <li class="fragment fade-in">
                            <b>Automatically</b> and
                            <b>atomically</b> updated on state change
                        </li>
                        <li class="fragment fade-in">
                            Updated
                            <b>synchronously</b>
                        </li>
                        <li class="fragment fade-in">
                            Computed are
                            <b>lazy</b>
                        </li>
                    </ul>
                </section>
                <section>
                    <h1>Actions</h1>
                    <pre>
                        <code class='ts' data-trim>
class User {
    ...
    @action setFirstName (firstName) {
        this.firstName = firstName
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    <h3>Unidirectional data flow</h3>
                    <img src="assets/flow.png" />
                </section>
                <section>
                    <h1>Derivations graph</h1>
                </section>
                <section>
                    <pre>
                        <code class='ts' data-trim>
class User {
    ...
    @observable nickName = null
}
                        </code>
                    </pre>
                    <pre>
                        <code class='ts' data-trim>
@observer
class UserInfo extends React.Component {
    render () {
        const { user } = this.props
        return <div>{user.nickName || user.fullName}</div>
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    <img src="assets/graph1.png" />
                </section>
                <section>
                    <pre>
                        <code class='ts'>
user.nickName = 'mobx-author'
                        </code>
                    </pre>
                    <pre class="fragment fade-in">
                        <code class='html'>
...
<div>{user.nickName || user.fullName}</div>
...
                        </code>
                    </pre>
                </section>
                <section>
                    <img src="assets/graph2.png" />
                </section>
            </section>


            <section>
                <section>
                    <h1>MobX in project</h1>
                </section>
                <section>
                    <h2>Too much freedom</h2>
                </section>
                <section>
                    <pre>
                        <code class='ts'>

  user.firstName = 'Tom'

  user.setFirstName('Tom')

                        </code>
                    </pre>
                </section>
                <section data-background-image="assets/strict.jpg">
                    <h3 class="text-on-bg">Be Strict</h3>
                    <pre>
                        <code class='ts'>

  configure({ enforceActions: "strict" });

                        </code>
                    </pre>
                </section>
                <section>
                    <h2>State
                        <span class="fragment strike" data-fragment-index="0">container</span>
                        <span class="fragment fade-in" data-fragment-index="0">library</span>
                    </h2>
                </section>
                <section>
                    <img class='nobg' src='assets/structure.png' />
                </section>
                <section>
                    <img class='nobg' src='assets/structure-spa.png' />
                </section>
                <section>
                    <ul class="folder-container">
                        <li class="folder-item">
                            <i data-feather="folder"></i> app
                        </li>
                        <li class="folder-wrapper">
                            <ul class="folder-container">
                                <li class="folder-item">
                                    <i data-feather="folder"></i> components
                                </li>
                                <li class="folder-item">
                                    <i data-feather="folder"></i> modules
                                </li>
                                <li class="folder-item">
                                    <i data-feather="folder"></i> stores
                                </li>
                                <li class="folder-item">
                                    <i data-feather="folder"></i> utils
                                </li>
                                <li class="file-item">
                                    <i data-feather="file"></i> App.js
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section>
                    <ul class="folder-container">
                        <li class="folder-item">
                            <i data-feather="folder"></i> modules
                        </li>
                        <li class="folder-wrapper">
                            <ul class="folder-container">
                                <li class="folder-item">
                                    <i data-feather="folder"></i> Chart
                                </li>
                                <li class="folder-wrapper">
                                    <ul class="folder-container">
                                        <li class="folder-item">
                                            <i data-feather="folder"></i> components
                                        </li>
                                        <li class="folder-item">
                                            <i data-feather="folder"></i> stores
                                        </li>
                                        <li class="folder-item">
                                            <i data-feather="folder"></i> utils
                                        </li>
                                        <li class="file-item">
                                            <i data-feather="file"></i> Chart.js
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </section>
                <section data-background-image='assets/magic-trick.jpg'>
                    <h1 class="text-on-bg">
                        It
                        <p style="position: relative;">
                            <p class="fragment fade-in" style="position:absolute; margin-left: auto; margin-right: auto; left: 0; right: 0;" data-fragment-index="0">
                                LOOKS LIKE
                            </p>
                            <p class="fragment fade-out" style="position:absolute; margin-left: auto; margin-right: auto; left: 0; right: 0;" data-fragment-index="0">
                                IS
                            </p>
                            <p>&nbsp;</p>
                        </p>
                        magic!
                    </h1>
                </section>
                <section>
                    <ul>
                        <li>
                            <a href="https://mobx.js.org/best/react.html">
                                What does MobX react to?
                            </a>
                        </li>
                        <li>
                            <a href="https://mobx.js.org/best/pitfalls.html">
                                Common pitfalls &amp; best practices
                            </a>
                        </li>
                    </ul>
                </section>
                <section>
                    <h2>
                        Design your data flow
                    </h2>
                </section>
                <section data-background-image="assets/chart.png" data-background-size="contain"></section>
                <section>
                    <pre>
                        <code class='ts' data-trim>
class DataStore {
    @observable trades = []
}
                        </code>
                    </pre>
                    <pre class="fragment fade-in">
                        <code class='ts' data-trim>
class TradesModuleStore {
    @observable filters = [['qty', '>', 5]]
    @computed get filteredTrades () {
        return this.dataStore.trades.filter(...)
    }
}
                        </code>
                    </pre>
                    <pre class="fragment fade-in">
                        <code class='ts' data-trim>
class TradesToolbarComponent extends React.Component {
    @computed get isExportEnabled () {
        return this.props.store.filteredTrades.length > 0
    }
}
                        </code>
                    </pre>
                </section>
                <section>
                    <p>
                        @computed
                    </p>
                    <p>
                        vs
                    </p>
                    <p>
                        @observable + reaction
                    </p>
                </section>
                <section>
                    <p>
                        Consider using MobX as local component state
                    </p>
                    <ul>
                        <li class="fragment fade-in">setState is asynchronous</li>
                        <li class="fragment fade-in">setState can cause unnecessary renders</li>
                        <li class="fragment fade-in">setState is not sufficient to capture all component state</li>
                    </ul>
                </section>
                <section>
                    Don't forget to dispose your reactions!
                </section>
            </section>
            <section>
                <section>
                    <h1>Problems</h1>
                </section>
                <section>
                    Prior to v5
                    <pre><code class='ts'>
Array.isArray(dataStore.trades) === false
                    </code></pre>
                    <pre><code class='ts'>
class DataStore {
    @observable tradesByCompany = {
        Apple: 1000
    }
}
dataStore.tradesByCompany.Apple // changes observed

dataStore.tradesByCompany.Microsoft // changes not observed
                    </code></pre>
                </section>
                <section>
                    Most third-party libraries expect immutability
                </section>
                <section>
                    Wasted renderings
                </section>
                <section>
                    Not rerended when needed
                </section>
                <section>
                    No time travel debugging
                </section>
                <section>
                    Undo/redo or changes sharing would require additional coding
                </section>
                <section>
                    Serialization/deserializaion
                    <p class="fragment fade-in">
                        <a href="https://github.com/mobxjs/serializr">https://github.com/mobxjs/serializr</a>
                    </p>
                </section>
                <section>
                    Decorators
                </section>
            </section>
            <section>
                <section>
                    <h1>Benefits</h1>
                </section>
                <section>
                    Steady learning curve
                    <p class="fragment fade-in">
                        <strong>Easy to learn, hard to master</strong>
                    </p>
                </section>
                <section>
                    Less boilerplate
                    <br/> (compared to redux)
                </section>
                <section>
                    Easy to integrate async data fetching
                    <pre><code class='ts'>
class DataStore {
    async loadTrades () {
        this.setLoadingTrades(true)
        try {
            const trades = await fetchTrades()
            this.setTrades(trades)
        } catch (err) {
            this.setError(err.message)
        }
        this.setLoadingTrades(false)
    }
}
                    </code></pre>
                </section>
                <section>
                    No need to normalize state
                </section>
                <section>
                    Performance out of box
                </section>
                <section>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>&nbsp;</th>
                                <th>Add Todo (ms)</th>
                                <th>Toggle Todo (ms)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="green">
                                <td>React</td>
                                <td>845</td>
                                <td>32</td>
                            </tr>
                            <tr class="red">
                                <td>Redux</td>
                                <td>2187</td>
                                <td>8887</td>
                            </tr>
                            <tr class="blue">
                                <td>Mobx</td>
                                <td>905</td>
                                <td>45</td>
                            </tr>
                            <tr class="blue fragment fade-in">
                                <td>Redux with decoupled state</td>
                                <td>860</td>
                                <td>49</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
                <section>
                    An artificial example where MobX really shines and Redux is not really suited for it
                    <img src="assets/paint.gif" />
                </section>
                <section>
                    <h3>Controlled observability</h3>
                    <h2 class="fragment fade-in">MobX Atoms</h2>
                </section>
                <section>
                    <img class="nobg" src="assets/subscription.png" />
                </section>
                <section>
                    <img class="nobg" src="assets/complex-subscription.png" />
                </section>
                <section>
                    <pre><code class="ts">
class PriceFieldAtom {
    atom = createAtom(
        "PriceField",
        () => this.subscribe(this.onUpdate), // onObserved
        () => this.unsubscribe() // onUnObserved
    );
}
                    </code></pre>
                </section>
                <section>
                    <pre><code class='ts'>
class PriceFieldAtom {
    ...
    get price () {
        this.atom.reportObserved()
        return this.dataSource.price
    }
    onUpdate = () => {
        this.atom.reportChanged()
    }
}
                    </code></pre>
                </section>
            </section>
            <section>
                <section>
                    What if we would like to have:
                    <ul>
                        <li class="fragment fade-in">State container</li>
                        <li class="fragment fade-in">Immutability</li>
                        <li class="fragment fade-in">Easy serialization/desirialization</li>
                        <li class="fragment fade-in">Time traveling</li>
                        <li class="fragment fade-in">Undo/redo</li>
                        <li class="fragment fade-in">Easy updates sharing</li>
                        <li class="fragment fade-in">Middlewares</li>
                        <li class="fragment fade-in">... and without redux boilerplate</li>
                    </ul>
                </section>
                <section>
                    <h1>mobx-state-tree</h1>
                </section>
                <section>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>&nbsp;</th>
                                <th>Add Todo (ms)</th>
                                <th>Toggle Todo (ms)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="green">
                                <td>React</td>
                                <td>845</td>
                                <td>32</td>
                            </tr>
                            <tr class="red">
                                <td>Redux</td>
                                <td>2187</td>
                                <td>887</td>
                            </tr>
                            <tr class="blue">
                                <td>Mobx</td>
                                <td>905</td>
                                <td>45</td>
                            </tr>
                            <tr class="blue">
                                <td>Redux decoupled state</td>
                                <td>860</td>
                                <td>49</td>
                            </tr>
                            <tr class="red">
                                <td>MobX State Tree</td>
                                <td>3813</td>
                                <td>835</td>
                            </tr>
                        </tbody>
                    </table>
                </section>
            </section>
            <section>
                Summary
                <section>
                    <p>
                        Was MobX a good choice for project?
                    </p>
                    <p class="fragment fade-in">
                        <strong>Definitelly!</strong>
                    </p>
                </section>
                <section>
                    <p>
                        Would I use MobX in future project?
                    </p>
                    <p class="fragment fade-in">
                        <strong>Yes!</strong>
                    </p>
                </section>
                <section>
                    <p>
                        Would MobX fit for any project?
                    </p>
                    <p class="fragment fade-in">
                        <strong>It is not a silver bullet!</strong>
                    </p>
                </section>
            </section>
            <section>
                <h3>Links</h3>
                <ul>
                    <li>
                        <a href="https://hackernoon.com/the-fundamental-principles-behind-mobx-7a725f71f3e8">
                            Fundamental principles behind MobX
                        </a>
                    </li>
                    <li>
                        <a href="https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367">
                            You Might Not Need Redux
                        </a>
                    </li>
                    <li>
                        <a href="https://www.youtube.com/watch?v=76FRrbY18Bs">
                            Preethi Kasireddy - MobX vs Redux: Comparing the Opposing Paradigms
                        </a>
                    </li>
                    <li>
                        <a href='https://blog.cloudboost.io/3-reasons-why-i-stopped-using-react-setstate-ab73fc67a42e'>
                            3 Reasons why I stopped using React.setState
                        </a>
                    </li>
                    <li>
                        <a href="https://hackernoon.com/an-artificial-example-where-mobx-really-shines-and-redux-is-not-really-suited-for-it-1a58313c0c70">
                            An artificial example where MobX really shines and Redux is not really suited for it
                        </a>
                    </li>
                </ul>
            </section>
            <section data-background-image="assets/questions.jpg">
            </section>
        </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        feather.replace({
            width: 32,
            height: 32
        })
        // More info about config & dependencies:
        // - https://github.com/hakimel/reveal.js#configuration
        // - https://github.com/hakimel/reveal.js#dependencies
        Reveal.initialize({
            history: true,
            defaultTiming: 60,
            dependencies: [
                { src: 'plugin/markdown/marked.js' },
                { src: 'plugin/markdown/markdown.js' },
                { src: 'plugin/notes/notes.js', async: true },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
            ]
        });
    </script>
</body>

</html>